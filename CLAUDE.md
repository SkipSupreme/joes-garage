# Joe's Garage Website V2

## Project Overview
Bicycle repair/rental shop website for Joe's Garage in Calgary, Alberta (joes-garage.ca).
Monorepo with three packages: `packages/frontend` (Astro), `packages/cms` (Payload CMS 3.x), `packages/api` (Express).

## Port Assignments
- **Port 3000**: node-social (PUBLIC-FACING — DO NOT TOUCH OR REASSIGN)
- **Port 3003**: Payload CMS admin panel
- **Port 3001**: Express API (booking system)
- **Port 4321**: Astro frontend dev server

## Database
- PostgreSQL at `postgresql://postgres:postgres@localhost:5434/joes_garage`
- Admin email: `joshhunterduvar@gmail.com`

---

## CRITICAL: Payload CMS 3.x CSS Packaging Bug

**This bug caused extensive debugging time. Do NOT repeat the same investigation.**

### The Problem
`@payloadcms/next` (v3.76.1) uses SWC compilation with a `removedExtensions` array that **strips all `.scss` imports** from compiled JavaScript. This means:

- Template SCSS files (`templates/Default/index.scss`, `templates/Default/Wrapper/index.scss`) are NOT imported in the compiled output
- No `.scss` files ship in `@payloadcms/next/dist/templates/`
- The entire `.template-default` grid layout and `.nav` sidebar positioning CSS is **completely missing** in dev mode
- This causes: nav sidebar full-width and unstyled, no grid layout, content not positioned correctly

Meanwhile, `@payloadcms/ui` components DO keep their SCSS imports (e.g., `NavToggler/index.js` has `import './index.scss'`).

### The Fix (already implemented)
All styles live in `packages/cms/src/app/(payload)/custom.scss` with a three-layer architecture:

1. **`@import '@payloadcms/ui/scss/app.scss'`** — Theme variables, colors, global resets. **NEVER remove this import.**
2. **`@layer payload-default { ... }`** — Missing template/nav CSS extracted from Payload's GitHub source. This is the bug workaround.
3. **Unlayered custom CSS** — Joe's Garage branding (overrides Payload defaults because unlayered CSS beats `@layer` in the CSS cascade).

### Rules
- **NEVER remove the `@import '@payloadcms/ui/scss/app.scss'` line** — it provides ALL theme variables
- **NEVER remove the `@layer payload-default` block** — it contains the missing template grid layout and nav sidebar CSS
- **NEVER modify `packages/cms/src/app/(payload)/layout.tsx`** — it's auto-generated by Payload
- If styles break, first check that these two sections are intact before investigating other causes
- The production CSS bundle exists at `@payloadcms/next/dist/prod/styles.css` (303KB) but is NOT auto-loaded in dev mode

### Source Files (for reference if Payload version changes)
The missing CSS was extracted from these Payload GitHub source files:
- `packages/next/src/templates/Default/index.scss` — Template container
- `packages/next/src/templates/Default/Wrapper/index.scss` — Grid layout (`display: grid`, `grid-template-columns`)
- `packages/next/src/elements/Nav/index.scss` — Nav sidebar (`position: sticky`, `height: 100vh`)

---

## Admin Panel Customization

### Custom Components (in `packages/cms/src/components/admin/`)
- `DarkThemeProvider.tsx` — Forces dark theme using `useTheme()` from `@payloadcms/ui`
- `Logo.tsx` — Joe's Garage logo (100px height, centered)
- `Icon.tsx` — Small icon variant for favicon/tab
- `BeforeLogin.tsx` — "CONTENT MANAGEMENT SYSTEM" subtitle on login page

### Styling
- All custom SCSS in `packages/cms/src/app/(payload)/custom.scss` (~757 lines)
- Brand color: `#D42B2B` (Joe's Garage red)
- Font: Instrument Sans (Google Fonts)
- CSS cascade: unlayered custom rules override Payload's `@layer payload-default` rules

### Verified Working Pages
- Login, Forgot Password, Dashboard, Collection List, Document Edit, Account, Site Settings
- Mobile responsive (375px iPhone tested)
